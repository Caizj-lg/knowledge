name: Notify Feishu on Tool Submission

on:
  repository_dispatch:
    types: [tool_submission]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send to Feishu (smoke test)
        env:
          FEISHU_WEBHOOK_URL: ${{ secrets.FEISHU_WEBHOOK_URL }}
        run: |
          set -e
          if [ -z "$FEISHU_WEBHOOK_URL" ]; then
            echo "FEISHU_WEBHOOK_URL is not set"
            exit 1
          fi
          curl -sS -X POST \
            -H "Content-Type: application/json" \
            -d '{"msg_type":"text","content":{"text":"飞书通知链路已跑通（repository_dispatch）"}}' \
            "$FEISHU_WEBHOOK_URL"
